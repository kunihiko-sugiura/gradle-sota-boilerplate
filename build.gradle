/*
 * This build file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at https://docs.gradle.org/4.1/userguide/tutorial_java_projects.html
 */

// Apply the java plugin to add support for Java
apply plugin: 'java'

// Apply the application plugin to add support for building an application
apply plugin: 'application'


buildscript {
  repositories {
    mavenCentral()
    maven {
      url "https://plugins.gradle.org/m2/"
    }
  }
  dependencies {
    classpath "org.hidetake:gradle-ssh-plugin:2.9.0"
  }
}
repositories {
  mavenCentral()
}

dependencies {
	compile 'com.google.guava:guava:22.0'
  compile group: 'com.google.code.gson', name: 'gson', version: '2.6.1'
	compile fileTree(dir: 'lib', include: '*.jar')
  testCompile 'junit:junit:4.12'
}
apply plugin: 'org.hidetake.ssh'

remotes {
  sota {
    host = "${sota_ip}"
    user = "${sota_user}"
    password = "${sota_pw}"
  }
}
task deploy {
  doLast {
    ssh.run {
      session(remotes.sota) {
        execute( "mkdir -p ${deploy_to}/${app_name}/")
        // execute( "[ ! -e ${deploy_to}/${app_name}/ ] && mkdir ${deploy_to}/${app_name}/")
  	    put from: "build/libs/${app_name}.jar", into: "${deploy_to}/${app_name}/${app_name}.jar"
      }
    }
  }
}
deploy.dependsOn build


// Define the main class for the application
mainClassName = 'App'

jar {
  doFirst {
    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
  }
  exclude 'META-INF/*.RSA', 'META-INF/*.SF','META-INF/*.DSA'
  manifest {
    attributes 'Implementation-Title': ''
    attributes 'Implementation-Version': 1.0
    attributes "Main-Class" : "App"
  }
  from configurations.compile.collect { it.isDirectory() ? it : zipTree(it) }
}